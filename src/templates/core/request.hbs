{{~#equals @root.httpClient 'fetch'}}{{>fetch/request}}{{/equals~}}
{{~#equals @root.httpClient 'xhr'}}{{>xhr/request}}{{/equals~}}
{{~#equals @root.httpClient 'node'}}{{>node/request}}{{/equals~}}

//

import schemas from '../schema.js';
import Ajv from 'ajv';

export function checkJsonSchema(operationId: string, result: ApiResult):boolean {
  let operation = schemas[operationId];
  if(!!!operation) {
    return false;
  }
  let responses = operation['responses'];
  if(!!!responses) {
    return false;
  }
  let code = result.status;
  let r = responses[code.toString()];
  if(!!!r) {
    return false;
  }

  const ajv = new Ajv();
  const validator = ajv.compile(r);
  const valid = validator(r, result.body);
  if(!!!valid) {
    console.info(validator.errors);
    throw new ApiError(result, "服务器数据校验错误");
  }

  return true;
}
